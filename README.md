# nao_webots
An interface between ROS and Webots for the NAO robot

## Requirements
* Webots
* [`webots_run`](http://github.com/mmattamala/webots_run.git) package
* [`naoqi_bridge_msgs`](https://github.com/ros-naoqi/naoqi_bridge_msgs) package

## Preliminaries
We must set some environment variables before:
* Set `WEBOTS_HOME` to the folder where you put Webots. Example: `WEBOTS_HOME=/home/matias/webots`
* Add `WEBOTS_HOME` to the `PATH`. Example: `PATH=${PATH}:${WEBOTS_HOME}`

## Compilation and Installation
Since everything is _catkinized_, `catkin_make` is enough to build everything.

However, you **must copy** the executable generated by catkin (i.e. `nao_webots_node`) into the Webots controller folder. Particularly, you must copy the executable to `$WEBOTS_HOME/projects/robots/aldebaran/controllers/nao_webots_node` in order to let Webots to find the controller. (**This was fixed temporarily in the CmakeLists file, but in a not elegant way** )

## Running the nodes
It is **highly** recommended to use a launch file, you can use `run.launch` as an example. The `webots_run` package will allow you to execute Webots _within_ ROS, and automatically will use the controller set in the `world` file passed as argument to Webots(`nao_demo.wbt` by default).

Particularly, we launch a **controller** node to publish NAO sensor data within  ROS, as well as providing a simple control scheme based on a Webots example, using precomputed movements. We also run a **supervisor** node that publishes the ground truth torso pose.


## Some important notes
We use the `naoqi_bridge_msgs` package to publish the FSRs sensors within a `FloatArrayStamped` message. We fill it with the four FSR per foot following the order:

| `data`    | Left Foot   | Right Foot |
|---------- | ----------- |------------|
| `data[0]` | Front Left  | Front Left |
| `data[1]` | Front Right | Front Right|
| `data[2]` | Rear Right  | Rear Right |
| `data[3]` | Rear Left   | Rear Left  |

We also publish the total force measured by each foot in a `FloatStamped` message

